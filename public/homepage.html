<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRP 3 Game Reviews</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Bootstrap JS and Popper.js (required for Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Search and Filter Section -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <input type="text" id="titleSearch" class="form-control" placeholder="Search by Title...">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
            <div class="col-md-3">
                <select id="genreFilter" class="form-control">
                    <option value="">Select Genre</option>
                    <!-- Add genre options here -->
                </select>
            </div>
            <div class="col-md-3">
                <select id="platformFilter" class="form-control">
                    <option value="">Select Platform</option>
                    <!-- Add platform options here -->
                </select>
            </div>
            <div class="col-md-3">
                <select id="tagFilter" class="form-control">
                    <option value="">Select Tag</option>
                    <!-- Add tag options here -->
                </select>
            </div>
        </div>
    </div>

    <nav>
        <ul class="nav nav-tab">
            <li class="ml-auto">
                <a class="nav-link" href="Signin.html">Sign in</a>
                <a class="nav-link" href="CreateAccount.html">Create Account</a>
            </li>
        </ul>
    </nav>

    <header>
        <h1 class="text-center">Game Reviewer</h1>
    </header>

    <nav class="mt-3">
        <ul class="nav nav-tabs justify-content-center ">
            <li class="nav-item">
                <a class="nav-link" href="homepage.html">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="reviews.html">Reviews</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#section3">Genres</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#section3">Profile</a>
            </li>
        </ul>
    </nav>
    <div id="data-container">
        <!-- Data based on the desired key will be displayed here -->
    </div>

    <div id="pagination">
        <button onclick="prevPage()">Previous Page</button>
        <span id="currentPage">Page 1</span>
        <button onclick="nextPage()">Next Page</button>
    </div>

    <script>
        let currentPage = 1;
        const itemsPerPage = 10; // Number of items to display per page
        const apiKey = '48288ff667454f7681cb863cb83b9b82';

        // Function to fetch and display games data from JSON with pagination, search, and filters
        async function fetchData(page, searchQuery = '', genre = '', platform = '', tag = '') {
            try {
                const offset = (page - 1) * itemsPerPage;
                const searchParam = searchQuery ? `&search=${encodeURIComponent(searchQuery)}` : '';
                const genreParam = genre ? `&genres=${genre}` : '';
                const platformParam = platform ? `&platforms=${platform}` : '';
                const tagParam = tag ? `&tags=${tag}` : '';

                const response = await fetch(`https://api.rawg.io/api/games?dates=2023-01-01,2023-11-01&ordering=-added&key=${apiKey}&page_size=${itemsPerPage}&page=${page}&offset=${offset}${searchParam}${genreParam}${platformParam}${tagParam}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const jsonData = await response.json();
                console.log(jsonData);
                displayGamesData(jsonData);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }


        // Function to display games data from JSON on the HTML page
        function displayGamesData(data) {
            // Declare dataContainer outside the if statement
            const dataContainer = document.getElementById('data-container');
            const currentPageElement = document.getElementById('currentPage');

            // Check if the "results" key exists in the JSON data
            if ('results' in data) {
                // Extract the "results" key and display relevant information
                const gamesData = data.results;

                if (Array.isArray(gamesData) && gamesData.length > 0) {
                    // Display each game with a background image
                    const gamesList = gamesData.map(game => {
                        const backgroundImage = game.background_image || 'default-image-url.jpg';
                        return `<div class="game-container" style="background-image: url(${backgroundImage})">
                                    <p>${game.name}</p>
                                </div>`;
                    }).join('');

                    dataContainer.innerHTML = gamesList;
                    currentPageElement.textContent = `Page ${currentPage}`;
                } else {
                    dataContainer.textContent = 'No games data available.';
                    currentPageElement.textContent = 'Page 1';
                }
            } else {
                dataContainer.textContent = 'No "results" key found in the data.';
            }
        }

        // Event listener for search button
        document.querySelector('.btn-primary').addEventListener('click', searchGames);

        // Event listener for pressing 'Enter' in the search field
        document.querySelector('#titleSearch').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                searchGames();
            }
        });

        function searchGames() {
            const searchQuery = document.getElementById('titleSearch').value;
            const genre = document.getElementById('genreFilter').value;
            const platform = document.getElementById('platformFilter').value;
            const tag = document.getElementById('tagFilter').value;

            fetchData(1, searchQuery, genre, platform, tag);
        }

        // Function to go to the previous page
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                fetchData(currentPage);
            }
        }

        // Function to go to the next page
        function nextPage() {
            currentPage++;
            fetchData(currentPage);
        }

        async function fetchRawgData(endpoint) {
            try {
                const response = await fetch(`https://api.rawg.io/api/${endpoint}?key=${apiKey}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        async function populateFilters() {
            const genresData = await fetchRawgData('genres');
            const platformsData = await fetchRawgData('platforms');
            const tagsData = await fetchRawgData('tags');

            populateSelect('genreFilter', genresData.results);
            populateSelect('platformFilter', platformsData.results);
            populateSelect('tagFilter', tagsData.results);
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.id;
                opt.textContent = option.name;
                select.appendChild(opt);
            });
        }

        // Call the fetchData function when the page loads to show the initial page
        window.onload = () => {
            fetchData(currentPage);
            populateFilters();
        };

    </script>

    <footer>
        <p>&copy; 2023 GROUP 3 FINAL PROJECT</p>
    </footer>

</body>

</html>